{
  "id": "f5f1d51d-242d-4f15-99f3-a3040f95eda0",
  "prefix": "UpdateSOCardforMpos",
  "description": "Update cac so phieu the cao topup cua mpos ve theo ID trong mail monitor",
  "body": "CREATE TABLE #tempidpending (id INT)\nCREATE TABLE #Temposstatus (U_status TINYINT,DocEntry_POS INT,Saleoder_ID INT)\nINSERT INTO #tempidpending\n(\n    id\n)\nSELECT id FROM dbo.SalesOrders WITH (NOLOCK) WHERE id IN (\nSELECT id FROM dbo.SalesOrders WITH (NOLOCK) \nWHERE CreatedDateTime>CAST(GETDATE() AS date) AND SalesOrdersStatus=67 AND PayooService IN (45,46) AND ISNULL(POSSODocNum,0)=0 AND POSIsPushed=1\n) \nINSERT INTO #Temposstatus\n(\n    U_status,\n    DocEntry_POS,\n    Saleoder_ID\n)\nSELECT U_status,DocEntry_POS,Saleoder_ID FROM [10.1.13.71].FRT_POS.dbo.push_TheCao_CRM_innovation with (NOLOCK) WHERE Saleoder_ID  IN (\nSELECT * FROM #tempidpending \n)\n\n$CURSOR$\n--UPDATE s SET s.POSIsPushed=1,s.POSSODocNum=Temp.DocEntry_POS \n--FROM dbo.SalesOrders AS s WITH (NOLOCK) INNER JOIN #Temposstatus AS Temp ON s.id=Temp.Saleoder_ID \n--WHERE Temp.DocEntry_POS IS NOT NULL AND Temp.U_status=2\n\n\n\nSELECT Temp.*,s.POSSODocNum,s.POSIsPushed FROM dbo.SalesOrders AS s WITH (NOLOCK) INNER JOIN #Temposstatus AS Temp ON s.id=Temp.Saleoder_ID \nWHERE Temp.DocEntry_POS IS NOT NULL AND Temp.U_status=2\nDROP TABLE #tempidpending,#Temposstatus\n\nSELECT POSSODocNum,POSIsPushed, * FROM dbo.SalesOrders WITH (NOLOCK) \nWHERE CreatedDateTime>CAST(GETDATE() AS date) AND SalesOrdersStatus=67 AND ISNULL(POSIsPushed,'')='' AND PayooService IN (45,46)\n--EXEC dbo.sp_CRMv2_POS_PrePaidCard_AllInOne\n--\t@WarehouseCode = '30905', -- varchar(40)\n --   @IDList = '17575975,17575989,17575991,17576001,17576003,17575980,17575984', -- varchar(max)\n  --  @PushBy = '-1'\n\n"
}