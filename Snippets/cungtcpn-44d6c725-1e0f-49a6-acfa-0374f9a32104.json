{
  "id": "44d6c725-1e0f-49a6-acfa-0374f9a32104",
  "prefix": "cungtcpn",
  "description": "Check tồn kho cùng TCPN",
  "body": "DECLARE \n\t  @DocEntry INT\t\t\t= $CURSOR$\n\t, @OWTQDocEntryX INT\n\t, @OWTQDocEntryN INT\n\t, @CountMSP INT\n\t, @CountIMEI INT\n\nSELECT * INTO #tmpBookMSP FROM dbo.[@FPTRQROTA1] (NOLOCK) WHERE DocEntry = @DocEntry\nSELECT @OWTQDocEntryX = O.DocEntry FROM FRT_POS.dbo.OWTQ AS O WITH (NOLOCK) WHERE O.U_Numreq = @DocEntry AND O.DocType = 'X'\nSELECT @OWTQDocEntryN = O.DocEntry FROM FRT_POS.dbo.OWTQ AS O WITH (NOLOCK) WHERE O.U_Numreq = @DocEntry AND O.DocType = 'N'\n\nSELECT @CountMSP = SUM(U_Qutity) FROM #tmpBookMSP\nSELECT @CountIMEI = SUM(Quantity) FROM dbo.WTQ1 (NOLOCK) WHERE DocEntry = @OWTQDocEntryX\nSELECT @CountMSP AS TotalMSP, @CountIMEI AS TotalIMEI\n\nSELECT\n    T.U_ItmCod\n  , T.U_ItmNam\n  , T.U_Qutity\n  , '------' '------'\n  , O.ItemCode\n  , O.WhsCode\n  , O.OnHand\n  , O.Qty_Available\n  , O.Qty_Order\nFROM\n    #tmpBookMSP T\n    INNER JOIN dbo.OITW O (NOLOCK)\n        ON T.U_ItmCod = O.ItemCode\n           AND T.U_WhsEx = O.WhsCode;\n\nSELECT\n    W.ItemCode\n\t, W.Dscription\n\t, W.U_WhsCod\n\t, W.U_IMei\n\t, '-----' '-----'\n\t, O.ItemCode\n\t, O.WhsCode\n\t, O.DistNumber\n\t, O.Quantity\n\t, O.CommitQty\n\nFROM\n    dbo.WTQ1 W (NOLOCK)\n    INNER JOIN dbo.OSRN O (NOLOCK)\n        ON W.ItemCode = O.ItemCode\n           AND W.U_WhsCod = O.WhsCode\n           AND W.U_IMei = O.DistNumber\n\t\t   AND O.Quantity = 1\nWHERE\n\tW.DocEntry = @OWTQDocEntryX\n\t--AND O.DistNumber IS NULL\n\t--AND CommitQty = 0\n\nSELECT\n    W.ItemCode\n\t, W.Dscription\n\t, W.U_WhsCod\n\t, W.U_IMei\n\t, '-----' '-----'\n\t, O.ItemCode\n\t, O.WhsCode\n\t, O.DistNumber\n\t, O.Quantity\n\t, O.CommitQty\n\nFROM\n    dbo.WTQ1 W (NOLOCK)\n    INNER JOIN dbo.OSRN O (NOLOCK)\n        ON W.ItemCode = O.ItemCode\n           AND W.U_WhsTo = O.WhsCode\n           AND W.U_IMei = O.DistNumber\n\t\t   AND O.Quantity = 1\nWHERE\n\tW.DocEntry = @OWTQDocEntryN\n\t--AND O.DistNumber IS NULL\n\t--AND CommitQty = 0\n\nDROP TABLE #tmpBookMSP"
}