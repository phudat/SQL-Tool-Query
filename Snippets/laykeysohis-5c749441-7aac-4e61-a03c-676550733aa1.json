{
  "id": "5c749441-7aac-4e61-a03c-676550733aa1",
  "prefix": "laykeysohis",
  "description": "lay cac key phan mem qua sau thang",
  "body": "DECLARE @demfull TINYINT,@posdocnum VARCHAR(50) ='$CURSOR$'\nSELECT \n\tid,\n\tPOSSODocNum,\n\tSalesOrderCode,\n\tProductCode  \nINTO \n\t#tempheaderfull \nFROM \n\tdbo.SalesOrders_History_full WITH (NOLOCK) \nWHERE \n\tPOSSODocNum = @posdocnum \n\tAND SalesOrdersStatus=67\n\nSELECT @demfull= COUNT(id) FROM #tempheaderfull\nIF (@demfull >= 1)\nBEGIN\n\tCREATE TABLE #resultfull \n\t(\n\tPOSSODocNum VARCHAR(50), \n\tSalesOrderCode VARCHAR(50),\n\tProductCode VARCHAR(50),\n\tSerialCard VARCHAR(50),\n\tNumberCode VARCHAR(50)\n\t)\n\n    SELECT \n\t\tSalesOrderID,\n\t\tSerialCard,\n\t\tNumberCode \n\tINTO \n\t\t#tempdetailfull \n\tFROM \n\t\tdbo.SalesOrderDetails_History_Full WITH (NOLOCK) \n\tWHERE \n\t\tSalesOrderID IN (SELECT id FROM #tempheaderfull)\n\n\n\t\n\tINSERT INTO #resultfull\n\t(\n\t    POSSODocNum,\n\t    SalesOrderCode,\n\t    ProductCode,\n\t    SerialCard,\n\t    NumberCode\n\t)\n\t\n\tSELECT  \n\t\tHD.POSSODocNum,\n\t    HD.SalesOrderCode,\n\t    HD.ProductCode,\n\t    DT.SerialCard,\n\t    DT.NumberCode\n\tFROM  \n\t#tempheaderfull AS hd \n\tINNER JOIN #tempdetailfull AS dt ON HD.ID=DT.SalesOrderID\n\n\tSELECT r.POSSODocNum,r.SalesOrderCode,r.ProductCode,p.ProductName,r.NumberCode \n\tFROM #resultfull AS r LEFT JOIN dbo.POSConfig p WITH (nolock) ON r.ProductCode=p.ProductCode \n\tDROP TABLE  #resultfull,#tempdetailfull\n\t\nEND\nELSE\nBEGIN\n    SELECT 0 AS ReturnCode, N'Đơn hàng chưa được lấy key hoặc không còn tồn tại' AS ReturnMes\nEND\nDROP TABLE #tempheaderfull\n\n\n\n\n"
}