{
  "id": "1bdb1b75-25c9-4f62-bb30-bab5428f004c",
  "prefix": "keothutienvtb",
  "description": "Kéo lại GD thu tiền SO của máy cà thẻ VTB",
  "body": "DECLARE \n\t  @DocSO\t\t\tINT = $CURSOR$\n\t, @CardCode\t\t\tINT\n\t, @EplCode\t\t\tINT\n\t, @POSBankDocStatus CHAR(1)\n\nSELECT * INTO #tmpPOSBankPayment FROM dbo.[@FPTORCT_POSBank_Log] (NOLOCK) WHERE SODocEntry = @DocSO\nDELETE FROM dbo.[@FPTORCT] WHERE U_DocSO = @DocSO AND IsAutoCard = 'Y' AND U_Acbank = 7 AND U_MoCCad > 0\nSELECT @CardCode = CardCode, @EplCode = CreateBy, @POSBankDocStatus = DocStatus FROM dbo.ORDR (NOLOCK) WHERE DocEntry = @DocSO\nINSERT  INTO [@FPTORCT]\n\t(\n\t\t  CardType\n\t\t, U_CName\n\t\t, U_Acbank\n\t\t, U_CTLKCode\n\t\t, U_CTLKName\n\t\t, U_MoCash\n\t\t, U_MoCCad\n\t\t, U_CrDate\n\t\t, U_AccNum\n\t\t, U_AccName\n\t\t, U_BankTs\n\t\t, U_MoTran\n\t\t, U_DateTs\n\t\t, U_NumVch\n\t\t, U_NaVoch\n\t\t, U_MoVoCh\n\t\t, U_EDate\n\t\t, U_DocSO\n\t\t, U_DocDown\n\t\t, U_ShpCod\n\t\t, U_AcCash\n\t\t, U_TypCre\n\t\t, U_Acount\n\t\t, U_NumCre\n\t\t, U_AcVoch\n\t\t, U_Status\n\t\t, U_CrdCod\n\t\t, U_AcDate\n\t\t, U_EplCod\n\t\t, CreateDate\n\t\t, U_Desc\n\t\t, Is_VC_CRM\n\t\t, U_loaiCT\n\t\t, U_DocAR\n\t\t, IsAutoCard\n\t\t\t\t\t\t\t   \n\t)\nSELECT\n\t\tC.FRTCreditCard\n\t, C.FRTCreditCard\n\t, C.POSBankID\n\t, C.POSBankName\n\t, ''\n\t, 0\n\t, T.Amount\n\t, T.ChargedDateTime\n\t, ''\n\t, ''\n\t, ''\n\t, 0\n\t, T.ChargedDateTime\n\t, ''\n\t, ''\n\t, 0\n\t, T.ChargedDateTime\n\t, @DocSO\n\t, NULL\n\t, T.ShopCode\n\t, F.U_AccCash\n\t, C.FRTCreditCard\n\t, '113100100'\n\t, RIGHT(T.CardNo, 4)\n\t, ''\n\t, 1\n\t, @CardCode\n\t, T.ChargedDateTime\n\t, T.ChargedBy\n\t, T.ChargedDateTime\n\t, 'THU SO'\n\t, 1\n\t, NULL\n\t, 0\n\t, 'Y'\n\t\t\t\t\t\t\t\nFROM\n\t#tmpPOSBankPayment T\n\t\tLEFT JOIN FRT_MDM.dbo.OCRC_POSBank C (NOLOCK)\n\t\t\tON T.POSBankID = C.POSBankID AND T.CardType = C.POSBankCardName\n\t\tLEFT JOIN FRT_MDM.dbo.[@FPTSHOP] F WITH (NOLOCK)\n\t\t\tON T.ShopCode = F.Code COLLATE SQL_Latin1_General_CP1_CI_AS\n\nDROP TABLE #tmpPOSBankPayment"
}