{
  "id": "45ca7299-babd-44bd-849e-7ac1681b87ba",
  "prefix": "checkthecaoxuathoadon",
  "description": "Check the cao xuất hóa đơn",
  "body": "DECLARE\t@Date DATETIME = GETDATE() - 1\n\nSELECT * INTO #tmpSO FROM dbo.SalesOrders (NOLOCK) WHERE CONVERT(DATE, SalesOrderDate) = CONVERT(DATE, @Date) AND ISNULL(POSIsPushed, 0) IN (0, 2, 3) AND SalesOrdersStatus IN (67, 588) AND PayooService IN (45, 46)\nSELECT * INTO #tmpLogHD FROM [10.1.13.71].FRT_POS.dbo.log_Finish_SO_TheCao_XuatHD WITH (NOLOCK) WHERE CONVERT(DATE, createdate) = CONVERT(DATE, @Date)\n\nSELECT DISTINCT T.SO, T.ListID, CONVERT(INT, F.VALUE) AS ID INTO #tmpLogHDID FROM #tmpLogHD T OUTER APPLY dbo.ufn_StringToTable(T.ListID, ',', 0) F\nSELECT * FROM #tmpSO\nSELECT * FROM #tmpLogHD\nSELECT * FROM #tmpLogHDID\nSELECT S.POSIsPushed, S.POSSODocNum, S.SalesOrdersStatus, I.SO, I.ID, * FROM #tmpSO S LEFT JOIN #tmpLogHDID I ON I.ID = S.ID\n\n--UPDATE S SET S.POSIsPushed = 1, S.POSSODocNum = I.SO, S.POSPushBy = '-1' FROM dbo.SalesOrders S INNER JOIN #tmpLogHDID I ON I.ID = S.ID WHERE ISNULL(POSIsPushed, 0) IN (0, 2, 3)\nSELECT POSSODocNum, POSIsPushed, SalesOrdersStatus, * FROM dbo.SalesOrders (NOLOCK) WHERE CONVERT(DATE, SalesOrderDate) = CONVERT(DATE, GETDATE() - 1) AND ISNULL(POSIsPushed, 0) IN (0, 2, 3) AND SalesOrdersStatus IN (67, 588) AND PayooService IN (45, 46)\n\nDROP TABLE #tmpLogHD, #tmpSO, #tmpLogHDID\n"
}