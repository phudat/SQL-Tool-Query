{
  "id": "559f42e3-94fc-42a5-b1e7-54b86fe55aa4",
  "prefix": "monitorycdc",
  "description": "Monitor YCDC sai tình trạng",
  "body": "DECLARE\n\t  @FromDate DATE = DATEADD(MONTH, DATEDIFF(MONTH, 0, GETDATE()), 0)\n\t, @ToDate DATE = DATEADD(MONTH, DATEDIFF(MONTH, 0, GETDATE()) + 1, 0) - 1\n\nSELECT @FromDate, @ToDate\nSELECT\n    *\nINTO\n\t#tmpYCDCKhacTCPNDaXuat\nFROM\n    dbo.[@FPTRQROTA] (NOLOCK)\nWHERE\n    CONVERT(DATE, CreateDate) BETWEEN @FromDate AND @ToDate\n\tAND Status = 'X'\n\tAND U_RqType = 1\n\nSELECT\n    T.DocEntry\tAS YCDCDocEntry\n  , T.Status\tAS YCDCStatus\n  , T.U_ShpRec\tAS YCDCShopXuat\n  , T.U_ShpCod\tAS YCDCShopNhap\n  , T.Series\tAS YCDCLoai\n  , O.DocEntry\tAS SODocEntry\n  , o.DocStatus\tAS SODocStatus\nINTO\n\t#tmpYCDC_SO\nFROM\n    #tmpYCDCKhacTCPNDaXuat T\n\t\tINNER JOIN dbo.ORDR O (NOLOCK)\n\t\t\tON T.DocEntry = O.U_NumReq;\n\nSELECT\n\t  T.*\n\t, O.DocEntry\tAS GRPODocEntry\n\t, O.DocStatus\tAS GRPODocStatus\nINTO\n\t#tmpYCDc_SO_GRPO\nFROM\n    #tmpYCDC_SO T\n\t\tLEFT JOIN dbo.OPDN O (NOLOCK)\n\t\t\tON T.YCDCDocEntry = O.U_NumReq\n\t\t\t\tAND T.SODocEntry = O.U_NumSO\n\nSELECT\n    T.YCDCDocEntry\n  , COUNT(*) AS CountOfSO\nINTO\n    #tmpCountSO\nFROM\n    #tmpYCDc_SO_GRPO T\nWHERE\n    T.SODocStatus = 'F'\nGROUP BY\n\tT.YCDCDocEntry\n\nSELECT\n    T.YCDCDocEntry\n  , COUNT(*) AS CountOfGRPO\nINTO\n    #tmpCountGRPO\nFROM\n    #tmpYCDc_SO_GRPO T\nWHERE\n    T.GRPODocStatus = 'F'\nGROUP BY\n\tT.YCDCDocEntry\n\nSELECT\n    *\nFROM\n    #tmpCountSO S\n\t\tLEFT JOIN #tmpCountGRPO G\n\t\t\tON G.YCDCDocEntry = S.YCDCDocEntry\nWHERE\n    G.CountOfGRPO = S.CountOfSO\n    AND G.CountOfGRPO > 0;\n\nDROP TABLE \n\t  #tmpCountGRPO\n\t, #tmpCountSO\n\t, #tmpYCDCKhacTCPNDaXuat\n\t, #tmpYCDC_SO\n\t, #tmpYCDc_SO_GRPO"
}