{
  "id": "0ad6cf5e-84da-464e-8f85-a349042f2db1",
  "prefix": "monitorlechthuegr",
  "description": "Monitor lệch thuế GR",
  "body": "SELECT\n    O.DocEntry\n  , O.DocStatus\n  , O.U_ShpCod\n  , O.DocDate\n  , O.U_GRDocEntry\n  , R.ItemCode AS ORPDItemcode\n  , R.Dscription AS ORPDItemName\n  , R.U_WhsCod AS ORPDWhsCod\n  , R.Quantity AS ORPDQuantity\n  , R.U_IMei AS ORPDIMEI\n  , R.Price AS ORPDPrice\n  , R.U_TaxAmo AS ORPDTaxAmo\n  , R.U_TMoney AS ORPDMoney\n  , R.U_TaxRate AS ORPDTaxRate\nINTO\n    #tmpGR\nFROM\n    dbo.ORPD O (NOLOCK)\n    INNER JOIN dbo.RPD1 R (NOLOCK)\n        ON O.DocEntry = R.DocEntry\nWHERE\n    CONVERT(DATE, O.DocDate) >= '20190801'\n    AND DocStatus <> 'C';\n\nSELECT\n\t  T.*\n\t, P.ItemCode\tAS GRPOItemcode\n\t, P.Dscription\tAS GRPOItemName\n\t, P.U_WhsCod\tAS GRPOWhsCod\n\t, P.Quantity\tAS GRPOQuantity\n\t, P.U_IMei\t\tAS GRPOIMEI\n\t, P.Price\t\tAS GRPOPrice\n\t, P.U_TaxAmo\tAS GRPOTaxAmo\n\t, P.U_TMoney\tAS GRPOMoney\n\t, P.U_TaxRate\tAS GRPOTaxRate\nINTO\n\t#tmpGRPOandGR\nFROM\n    #tmpGR T\n\t\tINNER JOIN dbo.PDN1 P (NOLOCK)\n\t\t\tON T.U_GRDocEntry = P.DocEntry\n\t\t\tAND T.ORPDItemcode = P.ItemCode\n\t\t\tAND ISNULL(T.ORPDIMEI, '') = ISNULL(P.U_IMei, '')\n\n\nSELECT\n\t  T.DocEntry\n\t, T.U_GRDocEntry\n    , T.ORPDItemcode\n\t, T.GRPOItemcode\n\t, T.DocDate\n\t, T.DocStatus\n\t, T.ORPDIMEI\n\t, T.GRPOIMEI\n\t, T.ORPDPrice\n\t, T.GRPOPrice\n\t, T.ORPDQuantity\n\t, T.GRPOQuantity\n\t, T.ORPDTaxAmo\n\t, T.GRPOTaxAmo\n\t, T.ORPDMoney\n\t, T.GRPOMoney\nINTO #tmpLech\nFROM\n    #tmpGRPOandGR T\nWHERE\n    ROUND(ORPDTaxAmo, 3) <> ROUND(GRPOTaxAmo, 3)\n\n\tSELECT * FROM #tmpLech\n\n--UPDATE R SET R.U_TaxAmo = T.GRPOTaxAmo FROM #tmpLech T INNER JOIN dbo.RPD1 R (NOLOCK) ON R.DocEntry = T.DocEntry AND T.ORPDItemcode = R.ItemCode AND T.ORPDIMEI = R.U_IMei\n\n--DROP TABLE #tmpGR, #tmpGRPOandGR, #tmpLech"
}