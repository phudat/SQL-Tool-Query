{
  "id": "e248574f-b9a4-4a85-8d51-60912d0a13ef",
  "prefix": "Updatetongtien",
  "description": "do mpos day sai so tien ne crm update lai",
  "body": "DECLARE @billcode VARCHAR(100),@id INT,@totalamount NUMERIC(18,2),@card_fee NUMERIC(18,2),@date DATETIME\nSET @billcode='$CURSOR$'\nSET @totalamount=1\nSET @card_fee=1\nIF EXISTS (SELECT TOP 1 1 FROM PaymentBillReceipts_History WITH (NOLOCK) WHERE BillCode =@billcode) \nBEGIN\n    SELECT @id=id,@date=CreatedDateTime FROM dbo.PaymentBillReceipts_History WITH (NOLOCK) WHERE BillCode =@billcode\n\tSELECT TotalAmount,Card_Fee,* FROM dbo.CRM_POS_COLLECTION_ON_BEHALF_PUSH_HISTORY WITH (NOLOCK) WHERE CreateDate>@date AND CRMID = @id\n\tSELECT U_DocAR, U_Status, U_AcDate, Object,U_ShpCod,*  FROM [10.1.13.71].FRT_POS.dbo.[@FPTORCT] WITH (NOLOCK) WHERE U_DocAR IN ( @id) AND Object='0006'\n\tUPDATE dbo.PaymentBillReceipts_History SET TotalAmount = @totalamount, CardPaymentFee = @card_fee WHERE BillCode = @billcode\n\tUPDATE dbo.CRM_POS_COLLECTION_ON_BEHALF_PUSH_HISTORY SET TotalAmount=@totalamount, Card_Fee=@card_fee WHERE CRMID=@id AND VendorCode='0006'\n\tUPDATE [10.1.13.71].FRT_POS.dbo.[@FPTORCT] SET U_MoCCad=@totalamount WHERE U_DocAR IN ( @id) AND Object='0006' AND U_loaiCT=4\n\tUPDATE [10.1.13.71].FRT_POS.dbo.[@FPTORCT] SET U_MoCCad=@card_fee WHERE U_DocAR IN ( @id) AND Object='0006' AND U_loaiCT=16--Phi\nEND\nIF EXISTS (SELECT TOP 1 1 FROM PaymentBillReceipts WITH (NOLOCK) WHERE BillCode =@billcode) \nBEGIN\n    SELECT @id=id,@date=CreatedDateTime FROM dbo.PaymentBillReceipts WITH (NOLOCK) WHERE BillCode =@billcode\n\tSELECT TotalAmount,Card_Fee,* FROM dbo.CRM_POS_COLLECTION_ON_BEHALF_PUSH WITH (NOLOCK) WHERE CreateDate>@date AND CRMID = @id\n\tSELECT U_DocAR, U_Status, U_AcDate, Object,U_ShpCod,*  FROM [10.1.13.71].FRT_POS.dbo.[@FPTORCT] WITH (NOLOCK) WHERE U_DocAR IN ( @id) AND Object='0006'\n\tUPDATE dbo.PaymentBillReceipts SET TotalAmount = @totalamount, CardPaymentFee = @card_fee WHERE BillCode = @billcode\n\tUPDATE dbo.CRM_POS_COLLECTION_ON_BEHALF_PUSH SET TotalAmount=@totalamount, Card_Fee=@card_fee WHERE CRMID=@id AND VendorCode='0006'\n\tUPDATE [10.1.13.71].FRT_POS.dbo.[@FPTORCT] SET U_MoCCad=@totalamount WHERE U_DocAR IN ( @id) AND Object='0006' AND U_loaiCT=4\n\tUPDATE [10.1.13.71].FRT_POS.dbo.[@FPTORCT] SET U_MoCCad=@card_fee WHERE U_DocAR IN ( @id) AND Object='0006' AND U_loaiCT=16--Phi\nEND"
}