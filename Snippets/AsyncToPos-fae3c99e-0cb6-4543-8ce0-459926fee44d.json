{
  "id": "fae3c99e-0cb6-4543-8ce0-459926fee44d",
  "prefix": "AsyncToPos",
  "description": "Bắn các giao dịch thu hộ thẻ cào về POS",
  "body": "CREATE TABLE #temp ( [orderId] varchar(100) )\nINSERT INTO #temp ([orderId])\nVALUES\n( 'b507334b-41b6-fdca-154b-3a0154470822' )\n$CURSOR$\n\nCREATE TABLE #tempupdate(orderId VARCHAR(50), updatetime DATETIME, stattusUpdate int)\n\n\tDECLARE CUR_PO CURSOR \n\tFOR \n\t\tSELECT  orderID FROM #temp WITH (NOLOCK)\n\tOPEN CUR_PO\t\t\n\tDECLARE @ID VARCHAR(50) \n\tFETCH NEXT FROM CUR_PO INTO @ID\n\twhile ( @@FETCH_STATUS = 0)\n\tbegin\n\t\tIF EXISTS (SELECT TOP 1 1 FROM [SOM-Legacy-Message].[Cap].[Published] WITH (NOLOCK) WHERE  Name = 'FRT.LegacyAPI.PayinEto' AND Content like '%'+@ID+'%' )\n\t\tBEGIN\n\t\t\tUPDATE [SOM-Legacy-Message].[Cap].[Published] SET Retries = 1, StatusName = 'Failed' WHERE  Name = 'FRT.LegacyAPI.PayinEto' AND Content like '%'+@id+'%'\n\t\t    INSERT INTO #tempupdate\n\t\t    (\n\t\t        orderId,\n\t\t        updatetime,\n\t\t        stattusUpdate\n\t\t    )\n\t\t    VALUES\n\t\t    (   @id,        -- orderId - varchar(50)\n\t\t        GETDATE(), -- updatetime - datetime\n\t\t        1          -- stattusUpdate - int\n\t\t    )\n\t\tEND\n\t\tELSE \n\t\tBEGIN\n\t\t    INSERT INTO #tempupdate\n\t\t    (\n\t\t        orderId,\n\t\t        updatetime,\n\t\t        stattusUpdate\n\t\t    )\n\t\t    VALUES\n\t\t    (   @id,        -- orderId - varchar(50)\n\t\t        GETDATE(), -- updatetime - datetime\n\t\t        0          -- stattusUpdate - int\n\t\t    )\n\t\tEND\n\t\tFETCH NEXT FROM CUR_PO INTO @ID\n\tEND\n\tCLOSE CUR_PO\n\tDEALLOCATE CUR_PO\nDROP TABLE #temp\nSELECT * FROM #tempupdate WITH (NOLOCK)\nDROP TABLE #tempupdate\n--SELECT * FROM [SOM-Legacy-Message].[Cap].[Published] WITH (NOLOCK) WHERE  Name = 'FRT.LegacyAPI.PayinEto' AND Content like N'%b507334b-41b6-fdca-154b-3a0154470822%'"
}