{
  "id": "6e7464fe-1342-48d1-a9d4-4520e74f559c",
  "prefix": "fixlechhddt",
  "description": "Fix lệch Hóa đơn điện tử",
  "body": "DECLARE\n        @ComCode VARCHAR(10)= '090800'\n      , @MaxLineNum INT\n      , @DaSuDung INT\n      , @LineNum INT\n\nSELECT @DaSuDung = COUNT(*) FROM dbo.[@FPT_BILL_HDDT_TEMP] (NOLOCK) WHERE ComCode = @ComCode\nSELECT @MaxLineNum = MaxLineNum FROM dbo.[@FPT_BILL_HDDT_TEMP_INDEX] (NOLOCK) WHERE ComCode = @ComCode\n--SELECT * FROM dbo.[@FPTBILL_HDDT] (NOLOCK) WHERE U_ComCode = '090800' AND U_Status = 1 ORDER BY LineNum\n\nSET @LineNum = @MaxLineNum + @DaSuDung\nSELECT @MaxLineNum MaxLineNum, @DaSuDung N'Đã sử dụngh', @MaxLineNum + @DaSuDung AS LineNum\n\nSELECT * FROM dbo.[@FPTBILL_HDDT] (NOLOCK) WHERE U_ComCode = @ComCode AND LineNum BETWEEN @LineNum - 20 AND @LineNum + 20\n\nRETURN\n-- Khúc này fix lệch HDDT, insert 1 dòng, update 1 dòng\n--INSERT INTO dbo.[@FPT_BILL_HDDT_TEMP]\n--    (\n--         DocEntry_SO\n--       , ComCode\n--       , U_SysBill\n--       , U_NuBill\n--       , U_MauHD\n--       , CreateDate\n--    )\n--VALUES\n--    (\n--         0  -- DocEntry_SO - bigint\n--       , '090800'  -- ComCode - varchar(10)\n--       , 'BL/17E'  -- U_SysBill - varchar(20)\n--       , '0618015'  -- U_NuBill - varchar(20)\n--       , '01GTKT0/001'  -- U_MauHD - varchar(50)\n--       , GETDATE()  -- CreateDate - datetime\n--    )\n\n--UPDATE [@FPTBILL_HDDT] SET U_Status = 1 WHERE DocEntry = 13069260 AND U_NuBill = '0618015' AND U_Symbol = 'BL/17E' AND U_MauHD = '01GTKT0/001' AND U_ComCode = '090800'\n\n--UPDATE FRT_POS.dbo.[@FPT_BILL_HDDT_TEMP] SET DocEntry_SO = 16262441  WHERE DocEntry_SO = 0"
}