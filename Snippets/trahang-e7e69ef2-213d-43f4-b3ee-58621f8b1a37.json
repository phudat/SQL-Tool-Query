{
  "id": "e7e69ef2-213d-43f4-b3ee-58621f8b1a37",
  "prefix": "trahang",
  "description": "Ho tro shop day lai cac don hang loi",
  "body": "DECLARE @posso VARCHAR(50)='$CURSOR$', @ticket VARCHAR(10)='1000'\nDECLARE @status CHAR(1), @count TINYINT\nSELECT @status=DocStatus FROM [10.1.13.71].FRT_POS.dbo.ORDR with (NOLOCK) WHERE DocEntry = @posso\nSELECT @count=COUNT(1) FROM dbo.SalesOrders WITH (NOLOCK) WHERE POSSODocNum=@posso\nBEGIN\n    --UPDATE dbo.SalesOrders set POSSODocNum='',POSIsPushed=0,Remark=ISNULL(Remark,'')+' - OldPosso: '+ @posso+' - Ticket:'+ @ticket WHERE POSSODocNum=@posso\n\tSELECT @count AS RowUpdate, N'Cập nhật thành công!' AS Mess\nEND\nIF @status = ('C') AND @count=0\nBEGIN    \n\tSELECT @count AS RowUpdate,N'Đơn hàng đã hủy, không cần thao tác gì thêm.' AS Mess\nEND\nIF @status = ('W') AND @count>0\nBEGIN    \n\tSELECT @count AS RowUpdate,N'Đơn hàng trả theo từng dòng, check tay đi ba' AS Mess\nEND\nELSE\nBEGIN\n    SELECT @count AS RowUpdate,N'Trạng thái đơn hàng khác ''Hủy, Trả hàng, Trả từng dòng'' hoặc đã hỗ trợ update trên CRM.' AS Mess\n\tSELECT N'SELECT DocStatus, U_ShopSO,U_ShpCod,PickRmrk,* FROM [10.1.13.71].FRT_POS.dbo.ORDR with (NOLOCK) WHERE DocEntry ='+@posso+N'\n\tSELECT U_Return, * FROM [10.1.13.71].FRT_POS.dbo.RDR1 with (NOLOCK) WHERE DocEntry ='+@posso+N'\n\tSELECT * FROM dbo.SalesOrders WITH (NOLOCK) WHERE POSSODocNum='+@posso+N'\n\t--T: đã trả hết nguyên đơn hàng\n\t--W: TRẢ TỪNG LINE, U_Return = 2 là chưa hoàn tất, =3 đã hoàn tất\n\t--C: hủy\n\t--F: Hoàn tất' AS Query\nEND\n"
}