{
  "id": "40ca1d83-9c48-4372-9a26-5c13403fd053",
  "prefix": "sjob",
  "description": "Check jobs",
  "body": "SELECT \n\t sJOB.name N'Tên Job',\n\t sJOB.description N'Ghi chú Job',\n\t CASE sJOB.enabled WHEN 0 THEN N'Tắt' ELSE N'Đang chạy' END AS N'Trạng thái Job',\n\t sJOB.date_created N'Ngày tạo Job',\n\t sJSTP.step_name N'Tên Step',\n\t sJSTP.command N'Commnad',\n\t sJSTP.database_name N'Tên DB chạy Step',\n\t sSCH.name N'Tên Schedule',\n\t sSCH.active_start_date N'Chạy từ ngày',\n\t sSCH.active_end_date N'Kết thúc ngày',\n\t sSCH.active_start_time N'Chạy lúc',\n\t  CASE \n        WHEN [sSCH].[freq_type] = 64 THEN 'Start automatically when SQL Server Agent starts'\n        WHEN [sSCH].[freq_type] = 128 THEN 'Start whenever the CPUs become idle'\n        WHEN [sSCH].[freq_type] IN (4,8,16,32) THEN N'Định kỳ'\n        WHEN [sSCH].[freq_type] = 1 THEN N'1 lần'\n      END N'Loại đặt lịch'\n    , CASE [freq_type]\n        WHEN 1 THEN N'1 lần'\n        WHEN 4 THEN N'Mỗi ngày'\n        WHEN 8 THEN N'Hàng tuần'\n        WHEN 16 THEN N'Hàng tháng'\n        WHEN 32 THEN N'Hàng tháng - Phụ thuộc vào tuần suất chạy'\n        WHEN 64 THEN N'Start automatically when SQL Server Agent starts'\n        WHEN 128 THEN N'Start whenever the CPUs become idle'\n      END N'Lịch chạy'\n    , CASE [freq_type]\n        WHEN 4 THEN N'Chạy mỗi ' + CAST([freq_interval] AS VARCHAR(3)) + N' ngày'\n        WHEN 8 THEN N'Chạy mỗi ' + CAST([freq_recurrence_factor] AS VARCHAR(3)) \n                    + N' tuần vào '\n                    + CASE WHEN [freq_interval] & 1 = 1 THEN N'Sunday' ELSE '' END\n                    + CASE WHEN [freq_interval] & 2 = 2 THEN N', Monday' ELSE '' END\n                    + CASE WHEN [freq_interval] & 4 = 4 THEN N', Tuesday' ELSE '' END\n                    + CASE WHEN [freq_interval] & 8 = 8 THEN N', Wednesday' ELSE '' END\n                    + CASE WHEN [freq_interval] & 16 = 16 THEN N', Thursday' ELSE '' END\n                    + CASE WHEN [freq_interval] & 32 = 32 THEN N', Friday' ELSE '' END\n                    + CASE WHEN [freq_interval] & 64 = 64 THEN N', Saturday' ELSE '' END\n        WHEN 16 THEN N'Chạy ngày ' + CAST([freq_interval] AS VARCHAR(3)) \n                     + N' mỗi '\n                     + CAST([freq_recurrence_factor] AS VARCHAR(3)) + N' tháng'\n        WHEN 32 THEN N'Chạy vào '\n                     + CASE [freq_interval]\n                        WHEN 1 THEN N'Chủ nhật'\n                        WHEN 2 THEN N'Thứ hai'\n                        WHEN 3 THEN N'Thứ ba'\n                        WHEN 4 THEN N'Thứ tư'\n                        WHEN 5 THEN N'Thứ năm'\n                        WHEN 6 THEN N'Thứ sáu'\n                        WHEN 7 THEN N'Thứ bảy'\n                        WHEN 8 THEN N'Ngày'\n                        WHEN 9 THEN N'Ngày trong tuần'\n                        WHEN 10 THEN N'Ngày cuối tuầm'\n\t\t\t\t\t\t+ ' '\n                       END\n\t\t\t\t\t   + CASE [freq_relative_interval]\n                        WHEN 1 THEN N'Đầu tiên'\n                        WHEN 2 THEN N'Thứ hai'\n                        WHEN 4 THEN N'Thứ ba'\n                        WHEN 8 THEN N'Thứ tư'\n                        WHEN 16 THEN N'Cuối'\n                       END\n                     \n                     + N' của mỗi ' + CAST([freq_recurrence_factor] AS VARCHAR(3)) \n                     + N' tháng'\n      END AS N'Lặp lại'\n    , CASE [freq_subday_type]\n        WHEN 1 THEN N'Chạy 1 lần vào lúc ' \n                    + STUFF(\n                 STUFF(RIGHT('000000' + CAST([active_start_time] AS VARCHAR(6)), 6)\n                                , 3, 0, ':')\n                            , 6, 0, ':')\n        WHEN 2 THEN N'Chạy mỗi ' \n                    + CAST([freq_subday_interval] AS VARCHAR(3)) + N' giây giữa ' \n                    + STUFF(\n                   STUFF(RIGHT('000000' + CAST([active_start_time] AS VARCHAR(6)), 6)\n                                , 3, 0, ':')\n                            , 6, 0, ':')\n                    + ' & ' \n                    + STUFF(\n                    STUFF(RIGHT('000000' + CAST([active_end_time] AS VARCHAR(6)), 6)\n                                , 3, 0, ':')\n                            , 6, 0, ':')\n        WHEN 4 THEN N'Chạy mỗi ' \n                    + CAST([freq_subday_interval] AS VARCHAR(3)) + N' phút giữa ' \n                    + STUFF(\n                   STUFF(RIGHT('000000' + CAST([active_start_time] AS VARCHAR(6)), 6)\n                                , 3, 0, ':')\n                            , 6, 0, ':')\n                    + ' & ' \n                    + STUFF(\n                    STUFF(RIGHT('000000' + CAST([active_end_time] AS VARCHAR(6)), 6)\n                                , 3, 0, ':')\n                            , 6, 0, ':')\n        WHEN 8 THEN N'Chạy mỗi ' \n                    + CAST([freq_subday_interval] AS VARCHAR(3)) + N' giờ giữa ' \n                    + STUFF(\n                    STUFF(RIGHT('000000' + CAST([active_start_time] AS VARCHAR(6)), 6)\n                                , 3, 0, ':')\n                            , 6, 0, ':')\n                    + ' & ' \n                    + STUFF(\n                    STUFF(RIGHT('000000' + CAST([active_end_time] AS VARCHAR(6)), 6)\n                                , 3, 0, ':')\n                            , 6, 0, ':')\n      END N'Tần suất chạy'\nFROM\n    [msdb].[dbo].[sysjobs] AS [sJOB]\n    LEFT JOIN [msdb].[sys].[servers] AS [sSVR]\n        ON [sJOB].[originating_server_id] = [sSVR].[server_id]\n    LEFT JOIN [msdb].[dbo].[syscategories] AS [sCAT]\n        ON [sJOB].[category_id] = [sCAT].[category_id]\n    LEFT JOIN [msdb].[dbo].[sysjobsteps] AS [sJSTP]\n        ON [sJOB].[job_id] = [sJSTP].[job_id]\n        AND [sJOB].[start_step_id] = [sJSTP].[step_id]\n    LEFT JOIN [msdb].[sys].[database_principals] AS [sDBP]\n        ON [sJOB].[owner_sid] = [sDBP].[sid]\n    LEFT JOIN [msdb].[dbo].[sysjobschedules] AS [sJOBSCH]\n        ON [sJOB].[job_id] = [sJOBSCH].[job_id]\n    LEFT JOIN [msdb].[dbo].[sysschedules] AS [sSCH]\n        ON [sJOBSCH].[schedule_id] = [sSCH].[schedule_id]\nWHERE 1 = 1\n\t\n\tAND sJSTP.command LIKE '%$CURSOR$%'\n\t--AND sSCH.active_start_time = '224500'\n\t--AND freq_subday_type = 1\n\t--AND freq_type = 4 --\n\t--AND sJOB.name LIKE '%voucher%'"
}