{
  "id": "89308f68-b85f-4fcb-84ea-36623f254828",
  "prefix": "poscrm",
  "description": "Toàn bộ thông tin thu hộ / chi hộ CRM",
  "body": "DECLARE \n\t  @WarehouseCode\t\tVARCHAR(40) = '$CURSOR$'\n\t, @FromDate\t\t\t\tDATE\t\t= ''\n\t, @ToDate\t\t\t\tDATE\t\t= ''\n\t, @COB_Payoo\t\t\tBIT\t\t\t= 0\n\t, @COB_FTel\t\t\t\tBIT\t\t\t= 0\n\t, @COB_Agribank\t\t\tBIT\t\t\t= 0\n\t, @COB_Viettel\t\t\tBIT\t\t\t= 0\n\t, @COB_Momo\t\t\t\tBIT\t\t\t= 0\n\t, @COB_inasure\t\t\tBIT\t\t\t= 0\n\t, @COB_LognChau\t\t\tBIT\t\t\t= 0\n\t, @RefundAll\t\t\tBIT\t\t\t= 0\n\t, @POB_Momo\t\t\t\tBIT\t\t\t= 0\n\nIF @COB_Payoo = 1\n\tBEGIN -- Payoo\n\t\tSELECT\n\t\t\t  P.BillCode\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Số phiếu'\n\t\t\t, P.BillDate\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Ngày giao dịch'\n\t\t\t, ISNULL(P.TotalAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tổng tiền: TM + Thẻ + VC + CK'\n\t\t\t, P.PaymentFee\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Phí'\n\t\t\t, P.PaymentBillStatus\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tình trạng'\n\t\t\t, P.WarehouseCode\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Mã shop'\n\t\t\t, ISNULL(M.CashAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tiền mặt'\n\t\t\t, ISNULL(M.CardAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Cà thẻ'\n\t\t\t, ISNULL(M.VoucherAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Voucher'\n\t\t\t, ISNULL(M.TransferAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Chuyển khoản'\n\t\t\t, ISNULL(M.Card_Fee, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Phí cà thẻ'\n\t\t\t, CASE WHEN ISNULL(M.CardFeeTM, -1) = 1 AND M.Card_Fee > 0 THEN N'Tiền mặt' \n\t\t\t\t\tWHEN ISNULL(M.CardFeeTM, -1) = 1 AND M.Card_Fee > 0 THEN N'Thẻ'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tELSE N'Không'\n\t\t\tEND\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS N'Loại thu phí cà thẻ'\n\t\t\t, V.ConfirmedDate\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Ngày xác nhận kế toán'\n\t\t\t, CASE ISNULL(P.POSIsPushed, 0) WHEN 1 THEN N'Đã về POS' \n\t\t\t\t\t\t\t\t\t\t\tELSE N'Chưa về POS' \n\t\t\tEND\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'POS'\n\t\tFROM\n\t\t\t[10.1.13.76].FRTCRM.dbo.PaymentBillReceipts AS P WITH (NOLOCK)\n\t\t\t\tINNER JOIN [10.1.13.76].FRTCRM.dbo.POSPaymentMethod M WITH (NOLOCK)\n\t\t\t\t\tON P.ID = M.BillID\n\t\t\t\tINNER JOIN [10.1.13.76].FRTCRM.dbo.CashCollectionReceiptsNoVAT V (NOLOCK)\n\t\t\t\t\tON P.BillCode = V.RefCode        \n\t\tWHERE\n\t\t\t1 = 1\n\t\t\tAND P.WarehouseCode = @WarehouseCode\n\t\t\tAND CONVERT(DATE, P.BillDate) BETWEEN @FromDate AND @ToDate\n\t\tORDER BY\n\t\t\tP.WarehouseCode, P.BillDate\n\tEND\n\nIF @COB_FTel = 1\n\tBEGIN -- Ftel \n\t\tSELECT\n\t\t\t  C.ReceiptCode\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Số phiếu'\n\t\t\t, C.ReceiptDate\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Ngày giao dịch'\n\t\t\t, ISNULL(C.TotalAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tổng tiền: TM + Thẻ + VC + CK'\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Phí'\n\t\t\t, C.CashCollectionReceiptStatus\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tình trạng'\n\t\t\t, C.WarehouseCode\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Mã shop'\n\t\t\t, ISNULL(M.CashAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tiền mặt'\n\t\t\t, ISNULL(M.CardAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Cà thẻ'\n\t\t\t, ISNULL(M.VoucherAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Voucher'\n\t\t\t, ISNULL(M.TransferAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Chuyển khoản'\n\t\t\t, ISNULL(M.Card_Fee, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Phí cà thẻ'\n\t\t\t, CASE WHEN ISNULL(M.CardFeeTM, -1) = 1 AND M.Card_Fee > 0 THEN N'Tiền mặt' \n\t\t\t\t\tWHEN ISNULL(M.CardFeeTM, -1) = 1 AND M.Card_Fee > 0 THEN N'Thẻ'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tELSE N'Không'\n\t\t\tEND\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS N'Loại thu phí cà thẻ'\n\t\t\t, V.ConfirmedDate\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Ngày xác nhận kế toán'\n\t\t\t, CASE ISNULL(C.POSIsPushed, 0) WHEN 1 THEN N'Đã về POS' \n\t\t\t\t\t\t\t\t\t\t\tELSE N'Chưa về POS' \n\t\t\tEND\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'POS'\n\t\tFROM\n\t\t\t[10.1.13.76].FRTCRM.dbo.CashCollectionReceipts AS C WITH (NOLOCK)\n\t\t\t\tINNER JOIN [10.1.13.76].FRTCRM.dbo.POSPaymentMethod M WITH (NOLOCK)\n\t\t\t\t\tON C.ID = M.FtelBillID\n\t\t\t\tINNER JOIN [10.1.13.76].FRTCRM.dbo.CashCollectionReceiptsNoVAT V (NOLOCK)\n\t\t\t\t\tON C.ReceiptCode = V.RefCode        \n\t\tWHERE\n\t\t\t1 = 1\n\t\t\tAND C.WarehouseCode = @WarehouseCode\n\t\t\tAND CONVERT(DATE, C.ReceiptDate) BETWEEN @FromDate AND @ToDate\n\t\tORDER BY\n\t\t\tC.WarehouseCode, C.ReceiptDate\n\tEND\n\nIF @COB_Agribank = 1\n\tBEGIN -- Agribank \n\t\tSELECT\n\t\t\t  P.BillCode\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Số phiếu'\n\t\t\t, P.BillDate\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Ngày giao dịch'\n\t\t\t, ISNULL(P.TotalAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tổng tiền: TM + Thẻ + VC + CK'\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    AS 'Phí'\n\t\t\t, P.PaymentBillStatus\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tình trạng'\n\t\t\t, P.WarehouseCode\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Mã shop'\n\t\t\t, ISNULL(M.CashAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tiền mặt'\n\t\t\t, ISNULL(M.CardAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Cà thẻ'\n\t\t\t, ISNULL(M.VoucherAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Voucher'\n\t\t\t, ISNULL(M.TransferAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Chuyển khoản'\n\t\t\t, ISNULL(M.Card_Fee, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Phí cà thẻ'\n\t\t\t, CASE WHEN ISNULL(M.CardFeeTM, -1) = 1 AND M.Card_Fee > 0 THEN N'Tiền mặt' \n\t\t\t\t\tWHEN ISNULL(M.CardFeeTM, -1) = 1 AND M.Card_Fee > 0 THEN N'Thẻ'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tELSE N'Không'\n\t\t\tEND\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS N'Loại thu phí cà thẻ'\n\t\t\t, V.ConfirmedDate\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Ngày xác nhận kế toán'\n\t\t\t, CASE ISNULL(P.POSIsPushed, 0) WHEN 1 THEN N'Đã về POS' \n\t\t\t\t\t\t\t\t\t\t\tELSE N'Chưa về POS' \n\t\t\tEND\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'POS'\n\t\tFROM\n\t\t\t[10.1.13.76].FRTCRM.dbo.CRM_PaymentBillReceipt_AgriBank AS P WITH (NOLOCK)\n\t\t\t\tINNER JOIN [10.1.13.76].FRTCRM.dbo.POSPaymentMethod M WITH (NOLOCK)\n\t\t\t\t\tON P.ID = M.PayBillAgriID\n\t\t\t\tINNER JOIN [10.1.13.76].FRTCRM.dbo.CashCollectionReceiptsNoVAT V (NOLOCK)\n\t\t\t\t\tON P.BillCode = V.RefCode\n\t\tWHERE\n\t\t\t1 = 1\n\t\t\tAND P.WarehouseCode = @WarehouseCode\n\t\t\tAND CONVERT(DATE, P.BillDate) BETWEEN @FromDate AND @ToDate\n\t\tORDER BY\n\t\t\tP.WarehouseCode, P.BillDate\n\tEND\n\nIF @COB_Viettel = 1\n\tBEGIN -- Viettel \n\t\tSELECT\n\t\t\t  P.BillCode\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Số phiếu'\n\t\t\t, P.BillDate\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Ngày giao dịch'\n\t\t\t, ISNULL(P.TotalAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tổng tiền: TM + Thẻ + VC + CK'\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    AS 'Phí'\n\t\t\t, P.PaymentBillStatus\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tình trạng'\n\t\t\t, P.WarehouseCode\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Mã shop'\n\t\t\t, ISNULL(M.CashAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tiền mặt'\n\t\t\t, ISNULL(M.CardAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Cà thẻ'\n\t\t\t, ISNULL(M.VoucherAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Voucher'\n\t\t\t, ISNULL(M.TransferAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Chuyển khoản'\n\t\t\t, ISNULL(M.Card_Fee, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Phí cà thẻ'\n\t\t\t, CASE WHEN ISNULL(M.CardFeeTM, -1) = 1 AND M.Card_Fee > 0 THEN N'Tiền mặt' \n\t\t\t\t\tWHEN ISNULL(M.CardFeeTM, -1) = 1 AND M.Card_Fee > 0 THEN N'Thẻ'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tELSE N'Không'\n\t\t\tEND\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS N'Loại thu phí cà thẻ'\n\t\t\t, V.ConfirmedDate\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Ngày xác nhận kế toán'\n\t\t\t, CASE ISNULL(P.POSIsPushed, 0) WHEN 1 THEN N'Đã về POS' \n\t\t\t\t\t\t\t\t\t\t\tELSE N'Chưa về POS' \n\t\t\tEND\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'POS'\n\t\tFROM\n\t\t\t[10.1.13.76].FRTCRM.dbo.PaymentBillReceipts_Viettel AS P WITH (NOLOCK)\n\t\t\t\tINNER JOIN [10.1.13.76].FRTCRM.dbo.POSPaymentMethod M WITH (NOLOCK)\n\t\t\t\t\tON P.ID = M.ViettelPayID\n\t\t\t\tINNER JOIN [10.1.13.76].FRTCRM.dbo.CashCollectionReceiptsNoVAT V (NOLOCK)\n\t\t\t\t\tON P.BillCode = V.RefCode\n\t\tWHERE\n\t\t\t1 = 1\n\t\t\tAND P.WarehouseCode = @WarehouseCode\n\t\t\tAND CONVERT(DATE, P.BillDate) BETWEEN @FromDate AND @ToDate\n\t\tORDER BY\n\t\t\tP.WarehouseCode, P.BillDate\n\tEND\n\nIF @COB_Momo = 1\n\tBEGIN -- Momo\n\t    SELECT\n\t\t\t  CONVERT(VARCHAR, P.Id)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Số phiếu'\n\t\t\t, P.TransactionDate\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Ngày giao dịch'\n\t\t\t, ISNULL(P.Amount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tổng tiền: TM + Thẻ + VC + CK'\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    AS 'Phí'\n\t\t\t, P.TransactionMoMoStatus\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tình trạng'\n\t\t\t, P.WarehouseCode\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Mã shop'\n\t\t\t, ISNULL(M.CashAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tiền mặt'\n\t\t\t, ISNULL(M.CardAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Cà thẻ'\n\t\t\t, ISNULL(M.VoucherAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Voucher'\n\t\t\t, ISNULL(M.TransferAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Chuyển khoản'\n\t\t\t, ISNULL(M.Card_Fee, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Phí cà thẻ'\n\t\t\t, CASE WHEN ISNULL(M.CardFeeTM, -1) = 1 AND M.Card_Fee > 0 THEN N'Tiền mặt' \n\t\t\t\t\tWHEN ISNULL(M.CardFeeTM, -1) = 1 AND M.Card_Fee > 0 THEN N'Thẻ'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tELSE N'Không'\n\t\t\tEND\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS N'Loại thu phí cà thẻ'\n\t\t\t, V.ConfirmedDate\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Ngày xác nhận kế toán'\n\t\t\t, CASE ISNULL(P.POSIsPushed, 0) WHEN 1 THEN N'Đã về POS' \n\t\t\t\t\t\t\t\t\t\t\tELSE N'Chưa về POS' \n\t\t\tEND\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'POS'\n\t\tFROM\n\t\t\t[10.1.13.76].FRTCRM.dbo.TransactionMoMo AS P WITH (NOLOCK)\n\t\t\t\tINNER JOIN [10.1.13.76].FRTCRM.dbo.POSPaymentMethod M WITH (NOLOCK)\n\t\t\t\t\tON P.ID = M.MoMoId\n\t\t\t\tINNER JOIN [10.1.13.76].FRTCRM.dbo.CashCollectionReceiptsNoVAT V (NOLOCK)\n\t\t\t\t\tON CONVERT(VARCHAR, P.ID) = V.RefCode\n\t\tWHERE\n\t\t\t1 = 1\n\t\t\tAND P.WarehouseCode = @WarehouseCode\n\t\t\tAND CONVERT(DATE, P.TransactionDate) BETWEEN @FromDate AND @ToDate\n\t\tORDER BY\n\t\t\tP.WarehouseCode, P.TransactionDate\n\tEND\n\nIF @COB_inasure = 1\n\tBEGIN -- Bảo hiểm Vinasure\n\t    SELECT\n\t\t\t  CONVERT(VARCHAR, P.ID)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Số phiếu'\n\t\t\t, P.CreatedDateTime\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Ngày giao dịch'\n\t\t\t, ISNULL(P.Amount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tổng tiền: TM + Thẻ + VC + CK'\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    AS 'Phí'\n\t\t\t, P.VinasureStatus\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tình trạng'\n\t\t\t, P.WarehouseCode\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Mã shop'\n\t\t\t, ISNULL(M.CashAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tiền mặt'\n\t\t\t, ISNULL(M.CardAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Cà thẻ'\n\t\t\t, ISNULL(M.VoucherAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Voucher'\n\t\t\t, ISNULL(M.TransferAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Chuyển khoản'\n\t\t\t, ISNULL(M.Card_Fee, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Phí cà thẻ'\n\t\t\t, CASE WHEN ISNULL(M.CardFeeTM, -1) = 1 AND M.Card_Fee > 0 THEN N'Tiền mặt' \n\t\t\t\t\tWHEN ISNULL(M.CardFeeTM, -1) = 1 AND M.Card_Fee > 0 THEN N'Thẻ'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tELSE N'Không'\n\t\t\tEND\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS N'Loại thu phí cà thẻ'\n\t\t\t, V.ConfirmedDate\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Ngày xác nhận kế toán'\n\t\t\t, CASE ISNULL(P.POSIsPushed, 0) WHEN 1 THEN N'Đã về POS' \n\t\t\t\t\t\t\t\t\t\t\tELSE N'Chưa về POS' \n\t\t\tEND\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'POS'\n\t\tFROM\n\t\t\t[10.1.13.76].FRTCRM.dbo.VinasureHeader AS P WITH (NOLOCK)\n\t\t\t\tINNER JOIN [10.1.13.76].FRTCRM.dbo.POSPaymentMethod M WITH (NOLOCK)\n\t\t\t\t\tON P.ID = M.VinasureID\n\t\t\t\tINNER JOIN [10.1.13.76].FRTCRM.dbo.CashCollectionReceiptsNoVAT V (NOLOCK)\n\t\t\t\t\tON CONVERT(VARCHAR, P.ID) = V.RefCode\n\t\tWHERE\n\t\t\t1 = 1\n\t\t\tAND P.WarehouseCode = @WarehouseCode\n\t\t\tAND CONVERT(DATE, P.CreatedDateTime) BETWEEN @FromDate AND @ToDate\n\t\tORDER BY\n\t\t\tP.WarehouseCode, P.CreatedDateTime\n\tEND\n\nIF @COB_LognChau = 1\n\tBEGIN -- Thu hộ Long Chau\n\t    SELECT\n\t\t\t  P.BillCode\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Số phiếu'\n\t\t\t, P.BillDate\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Ngày giao dịch'\n\t\t\t, ISNULL(P.TotalAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tổng tiền: TM + Thẻ + VC + CK'\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    AS 'Phí'\n\t\t\t, P.LongChauStatus\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tình trạng'\n\t\t\t, P.WarehouseCode\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Mã shop'\n\t\t\t, ISNULL(M.CashAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tiền mặt'\n\t\t\t, ISNULL(M.CardAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Cà thẻ'\n\t\t\t, ISNULL(M.VoucherAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Voucher'\n\t\t\t, ISNULL(M.TransferAmount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Chuyển khoản'\n\t\t\t, ISNULL(M.Card_Fee, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Phí cà thẻ'\n\t\t\t, CASE WHEN ISNULL(M.CardFeeTM, -1) = 1 AND M.Card_Fee > 0 THEN N'Tiền mặt' \n\t\t\t\t\tWHEN ISNULL(M.CardFeeTM, -1) = 1 AND M.Card_Fee > 0 THEN N'Thẻ'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tELSE N'Không'\n\t\t\tEND\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS N'Loại thu phí cà thẻ'\n\t\t\t, V.ConfirmedDate\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Ngày xác nhận kế toán'\n\t\t\t, CASE ISNULL(P.POSIsPushed, 0) WHEN 1 THEN N'Đã về POS' \n\t\t\t\t\t\t\t\t\t\t\tELSE N'Chưa về POS' \n\t\t\tEND\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'POS'\n\t\tFROM\n\t\t\t[10.1.13.76].FRTCRM.dbo.PaymentBill_LongChauPharmacy AS P WITH (NOLOCK)\n\t\t\t\tINNER JOIN [10.1.13.76].FRTCRM.dbo.POSPaymentMethod M WITH (NOLOCK)\n\t\t\t\t\tON P.ID = M.ViettelPayID\n\t\t\t\tINNER JOIN [10.1.13.76].FRTCRM.dbo.CashCollectionReceiptsNoVAT V (NOLOCK)\n\t\t\t\t\tON P.BillCode = V.RefCode\n\t\tWHERE\n\t\t\t1 = 1\n\t\t\tAND P.WarehouseCode = @WarehouseCode\n\t\t\tAND CONVERT(DATE, P.BillDate) BETWEEN @FromDate AND @ToDate\n\t\tORDER BY\n\t\t\tP.WarehouseCode, P.BillDate\n\tEND\n\nIF @RefundAll = 1\n\tBEGIN\t-- Chi tiền hủy thu hộ\n\t    SELECT\n\t\t\t  CONVERT(VARCHAR, P.PaymentServiceCode)\t\t\t\t\t\t\t\t\t\tAS 'Số phiếu chi'\n\t\t\t, P.ReceiptCode\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Số phiếu thu'\n\t\t\t, P.CreatedDateTime\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Ngày giao dịch'\n\t\t\t, ISNULL(P.Amount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tổng tiền: TM + Thẻ + VC + CK'\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    AS 'Phí'\n\t\t\t, P.PaymentServiceStatus\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tình trạng'\n\t\t\t, P.WarehouseCode\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Mã shop'\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tiền mặt'\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Cà thẻ'\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Voucher'\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Chuyển khoản'\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Phí cà thẻ'\n\t\t\t, N'Không'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS N'Loại thu phí cà thẻ'\n\t\t\t, P.ConfirmedDate\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Ngày xác nhận kế toán'\n\t\t\t, CASE ISNULL(P.POSIsPushed, 0) WHEN 1 THEN N'Đã về POS' \n\t\t\t\t\t\t\t\t\t\t\tELSE N'Chưa về POS' \n\t\t\tEND\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'POS'\n\t\tFROM\n\t\t\t[10.1.13.76].FRTCRM.dbo.PaymentServices AS P WITH (NOLOCK)\n\t\tWHERE\n\t\t\t1 = 1\n\t\t\tAND P.WarehouseCode = @WarehouseCode\n\t\t\tAND CONVERT(DATE, P.PaymentServiceDate) BETWEEN @FromDate AND @ToDate\n\t\tORDER BY\n\t\t\tP.WarehouseCode, P.CreatedDateTime\n\tEND\n\nIF @POB_Momo = 1\t\n\tBEGIN -- Chi hộ Momo\n\t\tSELECT\n\t\t\t  CONVERT(VARCHAR, C.ID)\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Số phiếu'\n\t\t\t, C.TransactionDate\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Ngày giao dịch'\n\t\t\t, C.TotalAmount\n\t\t\t, ISNULL(C.Amount, 0)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tổng tiền: TM + Thẻ + VC + CK'\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    AS 'Phí'\n\t\t\t, C.CashOutStatus\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tình trạng'\n\t\t\t, C.WarehouseCode\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Mã shop'\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Tiền mặt'\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Cà thẻ'\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Voucher'\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Chuyển khoản'\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Phí cà thẻ'\n\t\t\t, 0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS N'Loại thu phí cà thẻ'\n\t\t\t, V.ConfirmDate\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'Ngày xác nhận kế toán'\n\t\t\t, CASE ISNULL(C.POSIsPushed, 0) WHEN 1 THEN N'Đã về POS' \n\t\t\t\t\t\t\t\t\t\t\tELSE N'Chưa về POS' \n\t\t\tEND\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS 'POS'\n\t\tFROM\n\t\t\t[10.1.13.76].FRTCRM.dbo.CashOutMoMoHeader AS C WITH (NOLOCK)\n\t\t\t\tINNER JOIN [10.1.13.76].FRTCRM.dbo.CRM_CashOutMoMo_AccCF V (NOLOCK)\n\t\t\t\t\tON C.ID = V.CashOutMoMoID\n\t\tWHERE\n\t\t\t1 = 1\n\t\t\tAND C.WarehouseCode = @WarehouseCode\n\t\t\tAND CONVERT(DATE, C.TransactionDate) BETWEEN @FromDate AND @ToDate\n\t\tORDER BY\n\t\t\tC.WarehouseCode, C.CreatedDateTime\n\tEND"
}