{
  "id": "e36b6a0a-8e9f-47f8-86bb-9ac69939d1fa",
  "prefix": "checkphanquyengiamgia",
  "description": "Check phân quyền giảm giá",
  "body": "SELECT DISTINCT\n      '---- Roles ---'\n    , R.JobtitleCode\n\t, R.FromAmount\n\t, R.ToAmount\n\t, R.U_Nganh\n\t, R.U_Loai\n\t, R.U_Nhan\n\t, '---- OITM ---'\n\t, O.ItemCode\n\t, O.ItemName\n\t, O.U_NG_CODE\n\t, O.ItmsGrpCod\n\t, O.FirmCode\n\t, '---- F03_Employees ---'\n\t, E.EmployeeCode\n\t, E.EmployeeName\n\t, E.JobTitle\n\t, E.Status\n\t, '---- F03_JobTitles ---'\n\t, J.JobTitleName\n\t, '---- F02_UserProductHierarchy ---'\n\t, U.HierarchyCodeL4\n\t, U.HierarchyCodeL5\n\t, U.HierarchyCodeL6\n\t, U.Status\nFROM\n    dbo.Roles R (NOLOCK)\n\t\tINNER JOIN FRT_MDM.dbo.OITM O (NOLOCK)\n\t\t\tON (R.U_Nganh = O.U_NG_CODE OR R.U_Nganh IN('', 'All'))\n\t\t\t\tAND (R.U_Loai = O.ItmsGrpCod OR R.U_Loai IN ('', '0'))\n\t\t\t\tAND (R.U_Nhan = O.FirmCode OR R.U_Nhan IN ('', '0'))\n\t\tLEFT JOIN [10.1.13.77].FRTInsideV2.dbo.F03_Employees E WITH (NOLOCK)\n\t\t\tON R.JobtitleCode = E.JobTitle\n\t\tLEFT JOIN [10.1.13.77].FRTInsideV2.dbo.F03_JobTitles J WITH (NOLOCK)\n\t\t\tON J.JobTitleCode = E.JobTitle\n\t\tLEFT JOIN [10.1.13.77].FRTInsideV2.dbo.F02_UserProductHierarchy U WITH (NOLOCK)\n\t\t\tON (R.U_Nganh = U.HierarchyCodeL4 OR U.HierarchyCodeL4 = '')\n\t\t\t\tAND (R.U_Loai = U.HierarchyCodeL5 OR U.HierarchyCodeL5 = '')\n\t\t\t\tAND (R.U_Nhan = U.HierarchyCodeL6 OR U.HierarchyCodeL6 = '')\n\t\t\t\tAND E.EmployeeCode = U.EmployeeCode\n\nWHERE\n    R.U_Group = 6\n    AND R.Status = 1\n\tAND R.DocType = 1\n\tAND O.ItemCode = '$CURSOR$'\n\t--AND E.Status = 'A'\n\t--AND U.Status = 'A'"
}