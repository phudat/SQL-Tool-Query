{
  "id": "b778ed98-e176-498a-b045-e523798a5faa",
  "prefix": "checktragop",
  "description": "Check trả góp theo đơn hàng",
  "body": "DECLARE \n\t  @DocEntry INT = $CURSOR$\n\t, @CardCode INT\n\t, @Phone VARCHAR(20)\n\t, @NTG NVARCHAR(500)\n\t, @MonBi NUMERIC (18, 6)\n\nSELECT @CardCode = O.CardCode, @NTG = O.U_CardCode, @MonBi = O.U_TMonBi FROM FRT_POS.dbo.ORDR AS O WITH (NOLOCK) WHERE O.DocEntry = @DocEntry\nSELECT @Phone = O.LicTradNum FROM FRT_POS.dbo.OCRD AS O WITH (NOLOCK) WHERE O.CardCode = @CardCode\nSELECT R.ItemCode, R.Dscription, R.U_IMei, R.Quantity, R.U_WhsCod, R.U_Price, R.U_TaxAmo, R.U_TaxAmL, R.DiscPrcnt, R.U_DisOther, ROUND(R.U_TMoney, 0) AS U_TMoney FROM FRT_POS.dbo.RDR1 AS R WITH (NOLOCK) WHERE R.DocEntry = @DocEntry\nSELECT @CardCode MKH, @Phone SDT, @NTG NTG, ROUND(@MonBi, 0) GiaTriDonhang\n\nIF @NTG = 667497\n\tBEGIN\n        SELECT\n\t\t\tN'HC' NTG\n          , CustomerPhone\n          , CustomerIDCard CMND\n          , ROUND(ISNULL(InterestRate * 100, 0), 2) LaiSuat\n          , TotalPrePaid TraTruoc\n          , ProfileID SoHopDong\n          , TermLoan KyHan\n          , ProductPrice AS GiaTriSanPham\n          , TotalPrePaid AS TraTruoc\n          , ISNULL(ProductPrice, 0) - ISNULL(TotalPrePaid, 0) KhoanVay\n\t\t  , ROUND(@MonBi, 0) - (ISNULL(ProductPrice, 0) - ISNULL(TotalPrePaid, 0)) AS PhaiThu\n        FROM\n            [10.1.13.61].FRTCallLogV2.dbo.HomeCredit_ShareProfile\n        WHERE\n            ReviewStatus IN ('S', 'N', 'A')\n            AND CustomerPhone = @Phone\n        ORDER BY\n            CreateDate DESC\n\tEND\nELSE IF @NTG = 1556545\n\tBEGIN\n\t\tSELECT\n\t\t\t 'FEC' NTG\n\t\t\t, CustomerPhone\n\t\t\t, CustomerIdCard CMND\n\t\t\t, ROUND(Q.Laisuat, 2, 0) LaiSuat\n\t\t\t, DownPaymentAmount TraTruoc\n\t\t\t, ContractNo_AgreementNo SoHopDong\n\t\t\t, TenureOfLoan KyHan\n\t\t\t, CreateDateTime\n\t\t\t, ISNULL(LoanAmount, 0) KhoanVay\n\t\t\t, ISNULL(InstallmentAmount, 0) KhoanVay1Thang\n\t\t\t, ROUND(@MonBi, 0) - ISNULL(LoanAmount, 0) AS PhaiThu\n\t\tFROM\n\t\t\t[10.1.13.61].FRTCallLogV2.dbo.TraGop_FEC_vs_FRT\n\t\t\t\tLEFT JOIN QuyDoiLaiSuatFEC Q\n\t\t\t\t\tON ProductSchemeName = Q.MaCTTraGop\n\t\tWHERE\n\t\t\tReviewStatus = 1\n\t\t\tAND CustomerPhone = '84' + RIGHT(@Phone, LEN(@Phone) - 1);\n\tEND\n\n\n"
}