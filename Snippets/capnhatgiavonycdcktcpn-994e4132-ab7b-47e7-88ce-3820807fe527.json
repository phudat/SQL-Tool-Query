{
  "id": "994e4132-ab7b-47e7-88ce-3820807fe527",
  "prefix": "capnhatgiavonycdcktcpn",
  "description": "Cập nhật giá vốn SO và GRPO cho lệnh tạo tay",
  "body": "DECLARE\n\t  @DocEntry\t\tINT = 0\n\t, @DocEntryGRPO INT = 0\n\t, @IsUpdate\t\tBIT = 0\n\t\nIF @IsUpdate = 0\n\tBEGIN\n\t\tSELECT\n\t\t\t  R.DocEntry\n\t\t\t, R.ItemCode\n\t\t\t, R.U_WhsCod\n\t\t\t, R.U_IMei\n\t\t\t, R.U_Price\n\t\t\t, '------------'\n\t\t\t, O.Docentry\n\t\t\t, O.ItemCode\n\t\t\t, O.Whscode\n\t\t\t, O.EMEI\n\t\t\t, O.OpenStockPrice\n\t\tFROM\n\t\t\tFRT_POS.dbo.RDR1 AS R WITH (NOLOCK)\n\t\t\t\tINNER JOIN dbo.FRT_POS_OIVL O (NOLOCK)\n\t\t\t\t\tON R.DocEntry = O.Docentry\n\t\t\t\t\t\tAND R.ItemCode = O.ItemCode\n\t\t\t\t\t\tAND R.U_IMei = O.EMEI\n\t\t\t\t\t\tAND R.U_WhsCod = O.Whscode\n\t\tWHERE\n\t\t\tR.DocEntry = @DocEntry\n\t\t\tAND R.U_Price <> O.OpenStockPrice\n\t\t\tAND O.TypeGD = 1\n\n\t\tSELECT\n\t\t\t  P.DocEntry\n\t\t\t, P.ItemCode\n\t\t\t, P.U_IMei\n\t\t\t, P.WhsCode\n\t\t\t, P.Price\n\t\t\t, '------------'\n\t\t\t, O.ItemCode\n\t\t\t, O.Whscode\n\t\t\t, O.EMEI\n\t\t\t, O.OpenStockPrice\n\t\tFROM\n\t\t\tFRT_POS.dbo.PDN1 AS P WITH (NOLOCK)\n\t\t\t\tINNER JOIN dbo.FRT_POS_OIVL O (NOLOCK)\n\t\t\t\t\tON P.ItemCode = O.ItemCode\n\t\t\t\t\t\tAND P.U_IMei = O.EMEI\n\t\tWHERE\n\t\t\tO.DocEntry = @DocEntry\n\t\t\tAND P.DocEntry = @DocEntryGRPO\n\t\t\tAND P.price <> O.OpenStockPrice\n\t\t\tAND O.TypeGD = 1\n\tEND\nELSE IF @IsUpdate = 1\n\tBEGIN\n\t\tUPDATE\n\t\t\tR\n\t\tSET\n\t\t\tR.U_Price = O.OpenStockPrice\n\t\tFROM\n\t\t\tFRT_POS.dbo.RDR1 AS R WITH (NOLOCK)\n\t\t\t\tINNER JOIN dbo.FRT_POS_OIVL O (NOLOCK)\n\t\t\t\t\tON R.DocEntry = O.Docentry\n\t\t\t\t\t\tAND R.ItemCode = O.ItemCode\n\t\t\t\t\t\tAND R.U_IMei = O.EMEI\n\t\t\t\t\t\tAND R.U_WhsCod = O.Whscode\n\t\tWHERE\n\t\t\tR.DocEntry = @DocEntry\n\t\t\tAND R.U_Price <> O.OpenStockPrice\n\t\t\tAND O.TypeGD = 1\n\n\t\tUPDATE\n\t\t\tP\n\t\tSET\n\t\t\tP.Price = O.OpenStockPrice\n\t\tFROM\n\t\t\tFRT_POS.dbo.PDN1 AS P WITH (NOLOCK)\n\t\t\t\tINNER JOIN dbo.FRT_POS_OIVL O (NOLOCK)\n\t\t\t\t\tON P.ItemCode = O.ItemCode\n\t\t\t\t\t\tAND P.U_IMei = O.EMEI\n\t\tWHERE\n\t\t\tO.DocEntry = @DocEntry\n\t\t\tAND P.DocEntry = @DocEntryGRPO\n\t\t\tAND P.price <> O.OpenStockPrice\n\t\t\tAND O.TypeGD = 1\n\tEND\n\n\n\n\n\n\n\n"
}