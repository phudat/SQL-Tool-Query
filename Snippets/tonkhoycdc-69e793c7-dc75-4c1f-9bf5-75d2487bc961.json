{
  "id": "69e793c7-dc75-4c1f-9bf5-75d2487bc961",
  "prefix": "tonkhoycdc",
  "description": "Check tồn kho YCDC dự án",
  "body": "DECLARE \n\t  @DocEntry INT\t\t\t= $CURSOR$\n\t, @OWTQDocEntryX INT\n\t, @OWTQDocEntryN INT\n\t, @CountMSP INT\n\t, @CountIMEI INT\n\nSELECT * INTO #tmpBookMSP FROM dbo.[@FPTRQROTA1] (NOLOCK) WHERE DocEntry = @DocEntry\nSELECT @OWTQDocEntryX = O.DocEntry FROM FRT_POS.dbo.OWTQ AS O WITH (NOLOCK) WHERE O.U_Numreq = @DocEntry AND O.DocType = 'X'\nSELECT @OWTQDocEntryN = O.DocEntry FROM FRT_POS.dbo.OWTQ AS O WITH (NOLOCK) WHERE O.U_Numreq = @DocEntry AND O.DocType = 'N'\n\nSELECT @CountMSP = SUM(U_Qutity) FROM #tmpBookMSP\nSELECT @CountIMEI = SUM(Quantity) FROM dbo.WTQ1 (NOLOCK) WHERE DocEntry = @OWTQDocEntryX\nSELECT @CountMSP AS TotalMSP, @CountIMEI AS TotalIMEI\n\nSELECT\n\t  N'BOOK Mã kho xuất' 'BOOK Mã kho xuất'\n\t, T.U_ItmCod\n\t, T.U_ItmNam\n\t, T.U_Qutity\n\t, '------' '------'\n\t, O.ItemCode\n\t, O.WhsCode\n\t, O.OnHand\n\t, O.Qty_Available\n\t, O.Qty_Order\nFROM\n    #tmpBookMSP T\n\t\tINNER JOIN dbo.OITW O (NOLOCK)\n\t\t\tON T.U_ItmCod = O.ItemCode\n\t\t\t\tAND T.U_WhsEx = O.WhsCode;\n\nSELECT\n\t  N'BOOK Mã kho nhập' 'BOOK Mã kho nhập'\n\t, T.U_ItmCod\n\t, T.U_ItmNam\n\t, T.U_Qutity\n\t, '------' '------'\n\t, O.ItemCode\n\t, O.WhsCode\n\t, O.OnHand\n\t, O.Qty_Available\n\t, O.Qty_Order\nFROM\n    #tmpBookMSP T\n\t\tINNER JOIN dbo.OITW O (NOLOCK)\n\t\t\tON T.U_ItmCod = O.ItemCode\n\t\t\t\tAND T.U_WhsRec = O.WhsCode;\n\nSELECT\n      N'BOOK IMEI kho xuất' 'BOOK IMEI kho xuất'\n    , W.ItemCode\n\t, W.Dscription\n\t, W.U_WhsCod\n\t, W.U_IMei\n\t, '-----' '-----'\n\t, O.ItemCode\n\t, O.WhsCode\n\t, O.DistNumber\n\t, O.Quantity\n\t, O.CommitQty\nFROM\n    dbo.WTQ1 W (NOLOCK)\n\t\tINNER JOIN dbo.OSRN O (NOLOCK)\n\t\t\tON W.ItemCode = O.ItemCode\n\t\t\t\tAND W.U_WhsCod = O.WhsCode\n\t\t\t\tAND W.U_IMei = O.DistNumber\n\t\t\t\tAND O.Quantity = 1\nWHERE\n\tW.DocEntry = @OWTQDocEntryX\n\t--AND O.DistNumber IS NULL\n\t--AND CommitQty = 0\n\nSELECT\n\t  N'BOOK IMEI kho nhập' 'BOOK IMEI kho nhập'\n    , W.ItemCode\n\t, W.Dscription\n\t, W.U_WhsCod\n\t, W.U_IMei\n\t, '-----' '-----'\n\t, O.ItemCode\n\t, O.WhsCode\n\t, O.DistNumber\n\t, O.Quantity\n\t, O.CommitQty\n\nFROM\n    dbo.WTQ1 W (NOLOCK)\n    INNER JOIN dbo.OSRN O (NOLOCK)\n        ON W.ItemCode = O.ItemCode\n           AND W.U_WhsTo = O.WhsCode\n           AND W.U_IMei = O.DistNumber\n\t\t   AND O.Quantity = 1\nWHERE\n\tW.DocEntry = @OWTQDocEntryN\n\t--AND O.DistNumber IS NULL\n\t--AND CommitQty = 0\n\nDROP TABLE #tmpBookMSP"
}